# git clone repo
cd
mkdir project
cd project
git clone https://github.com/WJakubowsk/BigDataProject.git

# copy Products and country_codes CSV using WinSCP into the newly created data/ folder in project root dir.
mkdir data

# conda installation (in root dir)
cd ~
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
chmod +x Miniconda3-latest-Linux-x86_64.sh
sh Miniconda3-latest-Linux-x86_64.sh # yes/enter to all question, wtch out for skipping conda license agreements
source ~/.bashrc  

# conda environment create from yaml file - from scripts/ dir
cd /home/vagrant/project/BigDataProject/scripts
conda env create -f environment.yml

# set OpenFDA API Key in the get_events_from_api.sh scripts
export OPENFDA_API_KEY="<YOUR API KEY>"

# download jq for API filtering
sudo apt update
sudo apt install jq --yes

# add port forwarding rules
ssh -L 8020:localhost:8020 vagrant@localhost
ssh -L 8088:localhost:8088 vagrant@localhost
ssh -L 9083:localhost:9083 vagrant@localhost
ssh -L 9090:localhost:9090 vagrant@localhost
ssh -L 9443:localhost:9443 vagrant@localhost
ssh -L 10000:localhost:10000 vagrant@localhost
ssh -L 5010:localhost:50010 vagrant@localhost
ssh -L 5070:localhost:50070 vagrant@localhost


# hdfs create directories
hdfs dfs -mkdir /user/vagrant/project
hdfs dfs -mkdir /user/vagrant/project/nifi_in
hdfs dfs -mkdir /user/vagrant/project/nifi_in/api

# hbase initialize thrift & zookeeper server
. /usr/local/hbase/bin/hbase thrift &
sudo -- sh -c 'export JAVA_HOME=/usr/local/java && 
/usr/local/hbase/bin/start-hbase.sh'
sudo -- sh -c 'export JAVA_HOME=/usr/local/java && 
/usr/local/hbase/bin/hbase-daemon.sh start regionserver'

# make bash scripts executable
directory="/home/vagrant/project/BigDataProject/scripts"
if [ -d "$directory" ]; then
    for file in "$directory"/*; do
        if [ -f "$file" ] && [ "${file: -3}" == ".sh" ]; then
            chmod +x "$file"
        fi
    done
else
    echo "Directory '$directory' does not exist."
fi
